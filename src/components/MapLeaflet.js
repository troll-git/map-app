import React, { useState, useEffect, useRef } from "react";
import {
  Map,
  TileLayer,
  WMSTileLayer,
  LayerGroup,
  LayersControl,
} from "react-leaflet";
import "leaflet/dist/leaflet.css";
import PolygonLayer from "../components/PolygonLayer";
import axios from "axios";
import { bounds } from "leaflet";

const MapLeaflet = () => {
  const [bbox, setBbox] = useState([
    [45, 56],
    [0, 5],
  ]);
  const [center, setCenter] = useState([49.56, 20.635]);
  const [dane, setDane] = useState(undefined);
  const [zoom, setZoom] = useState(20);

  useEffect(() => {
    const fetchData = async () => {
      const result = await axios("http://127.0.0.1:8000/api/dzialki/");
      console.log(result.data);
      setDane(result.data);
      //return result.data;
    };
    fetchData();
  }, []);
  useEffect(() => {
    console.log("dick");
  }, [zoom]);
  const getBbox = (bbox) => {
    setBbox(bbox);
  };

  const testG = () => {
    setZoom(Map.zoom);
    console.log(zoom);
  };

  return (
    <React.Fragment>
      <Map
        id="map"
        center={center}
        zoom={zoom}
        style={{ height: "800px" }}
        maxZoom={19}
        bounds={bbox}
        animate="true"
        //onClick={testG}
      >
        <LayerGroup>
          <LayersControl position="topright">
            <LayersControl.BaseLayer name="osm" checked={true}>
              <TileLayer
                attribution='&amp;copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
                url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
              />
            </LayersControl.BaseLayer>
            <LayersControl.BaseLayer name="esraj">
              <TileLayer
                attribution='Tiles © <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>'
                url="https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"
              />
            </LayersControl.BaseLayer>
            <LayersControl.Overlay name="orto">
              <WMSTileLayer
                url="http://159.65.197.227:8080/geoserver/cite/wms?"
                layers="stary"
                transparent={true}
                format="image/png"
                opacity={0.8}
              />
            </LayersControl.Overlay>
            <LayersControl.Overlay name="orto">
              <WMSTileLayer
                url="http://mapy.geoportal.gov.pl/wss/service/img/guest/ORTO/MapServer/WMSServer?"
                layers="Raster"
                transparent={true}
                format="image/png"
                opacity={0.8}
              />
            </LayersControl.Overlay>
          </LayersControl>
          {!!dane ? <PolygonLayer bbox={getBbox} dane={dane} /> : <p>dfd</p>}
        </LayerGroup>
      </Map>
    </React.Fragment>
  );
  function getData() {
    return {
      type: "FeatureCollection",
      // name: "parceltest",
      // crs: {
      //   type: "name",
      //properties: { name: "urn:ogc:def:crs:EPSG::3857" },
      //},
      features: [
        {
          type: "Feature",
          properties: {
            gid: 3417,
            objectid: 14432201.0,
            identyfika: "121016_4.0015.2241",
            powierzchn: 625.0,
            teryt: "1210164",
            numer: "2241",
            wojewodztw: "małopolskie",
            powiat: "nowosądecki",
            gmina: "Stary Sącz",
            data_od: "2016/03/03",
            shape_leng: 216.920619981378,
            shape_area: 624.14951665000001,
          },
          geometry: {
            type: "MultiPolygon",
            coordinates: [
              [
                [
                  [2296812.465052840765566, 6370482.086834626272321],
                  [2296840.455964676570147, 6370485.26275345031172],
                  [2296869.257679044269025, 6370489.401517627760768],
                  [2296946.892789762932807, 6370511.245877495966852],
                  [2296961.94034302374348, 6370514.590290878899395],
                  [2296965.000011786352843, 6370502.568269046954811],
                  [2296932.108053162693977, 6370494.645952554419637],
                  [2296873.318804006557912, 6370483.448029238730669],
                  [2296810.577433915808797, 6370471.491303901188076],
                  [2296812.465052840765566, 6370482.086834626272321],
                ],
              ],
            ],
          },
        },
        {
          type: "Feature",
          properties: {
            gid: 18236,
            objectid: 14464011.0,
            identyfika: "121016_4.0015.2240",
            powierzchn: 1989.0,
            teryt: "1210164",
            numer: "2240",
            wojewodztw: "małopolskie",
            powiat: "nowosądecki",
            gmina: "Stary Sącz",
            data_od: "2016/03/03",
            shape_leng: 233.12258328975,
            shape_area: 1986.6680250500001,
          },
          geometry: {
            type: "MultiPolygon",
            coordinates: [
              [
                [
                  [2296814.515516323037446, 6370506.616857816465199],
                  [2296873.411167453974485, 6370524.436109816655517],
                  [2296953.940749196335673, 6370549.088084368035197],
                  [2296958.875032462179661, 6370528.201464598998427],
                  [2296961.94034302374348, 6370514.590290878899395],
                  [2296946.892789762932807, 6370511.245877495966852],
                  [2296869.257679044269025, 6370489.401517627760768],
                  [2296840.455964676570147, 6370485.26275345031172],
                  [2296812.465052840765566, 6370482.086834626272321],
                  [2296814.515516323037446, 6370506.616857816465199],
                ],
              ],
            ],
          },
        },
        {
          type: "Feature",
          id: 4445241356,
          properties: {
            gid: 67552,
            objectid: 15313292.0,
            identyfika: "121016_4.0015.2242/2",
            powierzchn: 1370.0,
            teryt: "1210164",
            numer: "2242/2",
            wojewodztw: "małopolskie",
            powiat: "nowosądecki",
            gmina: "Stary Sącz",
            data_od: "2016/03/03",
            shape_leng: 167.72070555597799,
            shape_area: 1368.056295,
          },
          geometry: {
            type: "MultiPolygon",
            coordinates: [
              [
                [
                  [2296873.318804006557912, 6370483.448029238730669],
                  [2296932.108053162693977, 6370494.645952554419637],
                  [2296965.000011786352843, 6370502.568269046954811],
                  [2296970.900508407969028, 6370475.885485703125596],
                  [2296972.891473279334605, 6370468.272213186137378],
                  [2296937.750430824235082, 6370460.800418658182025],
                  [2296922.484612638130784, 6370457.825015629641712],
                  [2296879.252032191492617, 6370449.868188204243779],
                  [2296873.571781110949814, 6370482.045157409273088],
                  [2296873.318804006557912, 6370483.448029238730669],
                ],
              ],
            ],
          },
        },
        {
          type: "Feature",
          id: 7759986690,
          properties: {
            gid: 130031,
            objectid: 16047133.0,
            identyfika: "121016_4.0015.2229",
            powierzchn: 1576.0,
            teryt: "1210164",
            numer: "2229",
            wojewodztw: "małopolskie",
            powiat: "nowosądecki",
            gmina: "Stary Sącz",
            data_od: "2016/03/03",
            shape_leng: 403.699009518499,
            shape_area: 1574.0388839499999,
          },
          geometry: {
            type: "MultiPolygon",
            coordinates: [
              [
                [
                  [2296931.966915634926409, 6370637.945000370964408],
                  [2296962.033044737763703, 6370638.50885299965739],
                  [2296957.877707702573389, 6370635.416623900644481],
                  [2296953.573947191704065, 6370631.229818311519921],
                  [2296951.280553772114217, 6370628.147702515125275],
                  [2296949.662550551816821, 6370625.392625467851758],
                  [2296950.850165277253836, 6370612.250089109875262],
                  [2296949.157736853696406, 6370612.103169753216207],
                  [2296949.944323018193245, 6370599.143575597554445],
                  [2296959.713216487318277, 6370574.315685732290149],
                  [2296966.04093290027231, 6370554.346821751445532],
                  [2296972.305309337563813, 6370532.093916513957083],
                  [2296971.306517798919231, 6370531.765123189426959],
                  [2296976.180946617387235, 6370510.107879692688584],
                  [2296980.638895248994231, 6370488.987572930753231],
                  [2296984.519261507783085, 6370472.555791440419853],
                  [2296990.001181303523481, 6370449.373675457201898],
                  [2296994.446298234630376, 6370427.806125063449144],
                  [2297000.413155946880579, 6370402.914781654253602],
                  [2297007.490077191963792, 6370381.004352711141109],
                  [2296992.375957897398621, 6370356.441112972795963],
                  [2296992.317094247788191, 6370362.04305272269994],
                  [2296987.034594043157995, 6370397.988235117867589],
                  [2296984.616529116407037, 6370414.179409],
                  [2296982.862520964816213, 6370423.845755338668823],
                  [2296980.502937937155366, 6370434.559921325184405],
                  [2296978.527327909134328, 6370445.228678366169333],
                  [2296974.61298390571028, 6370462.153595],
                  [2296972.891473279334605, 6370468.272213186137378],
                  [2296970.900508407969028, 6370475.885485703125596],
                  [2296965.000011786352843, 6370502.568269046954811],
                  [2296961.94034302374348, 6370514.590290878899395],
                  [2296958.875032462179661, 6370528.201464598998427],
                  [2296953.940749196335673, 6370549.088084368035197],
                  [2296953.222846934106201, 6370551.13592676166445],
                  [2296951.095541484188288, 6370558.285723601467907],
                  [2296945.155402319040149, 6370574.322235464118421],
                  [2296938.22585483873263, 6370594.163860443048179],
                  [2296938.099754938855767, 6370594.81194459926337],
                  [2296937.799436104483902, 6370596.446114396676421],
                  [2296936.504895092919469, 6370603.369343806989491],
                  [2296936.185856872238219, 6370608.691579600796103],
                  [2296937.112047219648957, 6370624.019530158489943],
                  [2296936.896707553882152, 6370627.089705388993025],
                  [2296936.435932969208807, 6370633.475941209122539],
                  [2296935.203392737079412, 6370637.003587852232158],
                  [2296931.966915634926409, 6370637.945000370964408],
                ],
              ],
            ],
          },
        },
      ],
    };
  }
  function getGeoJson() {
    return {
      type: "FeatureCollection",
      features: [
        {
          type: "Feature",
          properties: {},
          geometry: {
            type: "LineString",
            coordinates: [
              [-122.47979164123535, 37.830124319877235],
              [-122.47721672058105, 37.809377088502615],
            ],
          },
        },
        {
          type: "Feature",
          properties: {},
          geometry: {
            type: "Point",
            coordinates: [-122.46923446655273, 37.80293476836673],
          },
        },
        {
          type: "Feature",
          properties: {},
          geometry: {
            type: "Point",
            coordinates: [-122.48399734497069, 37.83466623607849],
          },
        },
        {
          type: "Feature",
          properties: {},
          geometry: {
            type: "Point",
            coordinates: [-122.47867584228514, 37.81893781173967],
          },
        },
        {
          type: "Feature",
          properties: {},
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [-122.48069286346434, 37.800637436707525],
                [-122.48069286346434, 37.803104310307276],
                [-122.47950196266174, 37.803104310307276],
                [-122.47950196266174, 37.800637436707525],
                [-122.48069286346434, 37.800637436707525],
              ],
            ],
          },
        },
        {
          type: "Feature",
          properties: {},
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [-122.48103886842728, 37.833075326166274],
                [-122.48065531253813, 37.832558431940114],
                [-122.4799284338951, 37.8322660885204],
                [-122.47963070869446, 37.83231693093747],
                [-122.47948586940764, 37.832467339549524],
                [-122.47945636510849, 37.83273426112019],
                [-122.47959315776825, 37.83289737938241],
                [-122.48004108667372, 37.833109220743104],
                [-122.48058557510376, 37.83328293020496],
                [-122.48080283403395, 37.83332529830436],
                [-122.48091548681259, 37.83322785163939],
                [-122.48103886842728, 37.833075326166274],
              ],
            ],
          },
        },
        {
          type: "Feature",
          properties: {},
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [-122.48043537139893, 37.82564992009924],
                [-122.48129367828368, 37.82629397920697],
                [-122.48240947723389, 37.82544653184479],
                [-122.48373985290527, 37.82632787689904],
                [-122.48425483703613, 37.82680244295304],
                [-122.48605728149415, 37.82639567223645],
                [-122.4898338317871, 37.82663295542695],
                [-122.4930953979492, 37.82415839321614],
                [-122.49700069427489, 37.821887146654376],
                [-122.4991464614868, 37.82171764783966],
                [-122.49850273132326, 37.81798857543524],
                [-122.50923156738281, 37.82090404811055],
                [-122.51232147216798, 37.823344820392535],
                [-122.50150680541992, 37.8271414168374],
                [-122.48743057250977, 37.83093781796035],
                [-122.48313903808594, 37.82822612280363],
                [-122.48043537139893, 37.82564992009924],
              ],
            ],
          },
        },
      ],
    };
  }
};

export default MapLeaflet;
